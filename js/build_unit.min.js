function eco_struc_make_resource_row(e,b,d,a,c){if(b>0){b=c?b*jQuery("#unit_amount").val():b;document.getElementById("unit_"+e).style.visibility="visible";document.getElementById("unit_"+e).style.display="table-row";document.getElementById(e+"_price").innerHTML=sn_format_number(b,0,"positive",planet[e]);document.getElementById(e+"_left").innerHTML=sn_format_number(parseFloat(planet[e])-parseFloat(b),0,"positive");if(planet.fleet_own){document.getElementById(e+"_fleet").innerHTML=sn_format_number(parseFloat(planet[e])+parseFloat(planet[e+"_incoming"])-parseFloat(b),0,"positive");jQuery("#fleet_res").css("display","block")}else{document.getElementById(e+"_fleet").style.display="none"}}else{(a&&e!="dark_matter")||(!b&&e=="dark_matter")?(document.getElementById("unit_"+e).style.display="none"):(document.getElementById("unit_"+e).style.visibility="hidden")}}jQuery(document).ready(function(a){$(".unit_create,.unit_destroy,#unit_create_button_auto").on("click",function(b){if($(this).is(":disabled")||$(this).attr("aria-disabled")=="true"){b.preventDefault();return false}if($(this).attr("id")=="unit_create_button_auto"){if(DARK_MATTER<MARKET_AUTOCONVERT_COST){alert(language.eco_bld_autoconvert_explain+language.eco_bld_autoconvert_dark_matter_none);b.preventDefault();return false}if(!confirm(language.eco_bld_autoconvert_explain+language.eco_bld_autoconvert_confirm)){b.preventDefault();return false}}$("[name=action]").val($(this).hasClass("unit_create")?"create":($(this).hasClass("unit_destroy")?"destroy":"create_autoconvert"));$("#form_unit").submit()});$("#form_unit").on("keypress",function(b){if(b.which==13){if(!$("#unit_create_button").is("[disabled]")){$("#unit_create_button").click()}b.preventDefault();return false}});$("#unit_amount").on("change",function(){$("#unit_create_button").button(parseInt($("#unit_amount").val())?"enable":"disable")});jQuery("#unit_amount").on("keyup change",function(b,c){unit_id=$("#unit_id").val();unit=production[unit_id];eco_struc_make_resource_row("metal",unit.metal,unit.destroy_metal,unit.dark_matter,STACKABLE);eco_struc_make_resource_row("crystal",unit.crystal,unit.destroy_crystal,unit.dark_matter,STACKABLE);eco_struc_make_resource_row("deuterium",unit.deuterium,unit.destroy_deuterium,unit.dark_matter,STACKABLE);eco_struc_make_resource_row("dark_matter",unit.dark_matter,unit.destroy_dark_matter,unit.dark_matter,STACKABLE)});jQuery("#unit_table").on("mouseenter","*[unit_id]",function(b,c){eco_struc_show_unit_info(jQuery(this).attr("unit_id"))}).on("mouseleave","*[unit_id]",function(b,c){unit_selected!=jQuery(this).attr("unit_id")?jQuery(this).removeClass("unit_border_selected"):false}).on("click","*[unit_id]",function(b,c){eco_struc_select_unit(jQuery(this).attr("unit_id"))});$("#unit_info_extra_switch").on("click",function(){if($("#unit_balance").is(":visible")){$(this).children().html(language.eco_bld_unit_info_extra_show);$("#unit_balance").hide()}else{$(this).children().html(language.eco_bld_unit_info_extra_hide);$("#unit_balance").show()}});$("#auto_convert").on("change",function(){$("#unit_create, #unit_create *").prop("disabled",true);$("#unit_create_button").button("disable");unit_id=$("#unit_id").val();var b=production[unit_id];$("#unit_max_number").html(sn_format_number(b.can_build));if(b.autoconvert_amount){$("#auto_convert").prop("disabled",false).not(":checkbox").button("enable")}if(b.build_can!=0&&b.build_result==0){$("#unit_create, #unit_create *").prop("disabled",false);$("#unit_amountslide").slider({max:b.can_build})}if(!$("#auto_convert").is(":disabled")&&$("#auto_convert").attr("aria-disabled")!="true"&&$("#auto_convert").is(":checked")){$("#unit_create, #unit_create *").prop("disabled",false);$("#unit_amountslide").slider({max:b.autoconvert_amount});$("#unit_max_number").html(sn_format_number(b.autoconvert_amount))}else{if(b.build_can==0||b.build_result!=0){$("#unit_create, #unit_create *").prop("disabled",true);$("#unit_amountslide").slider({max:0,value:0});$("#unit_create_button").button("disable");$("#unit_amount").val(0)}}if(b.autoconvert_amount){$("#auto_convert").prop("disabled",false).not(":checkbox").button("enable")}$("#unit_amount").change()});if(!planet.fleet_own){jQuery("[hide_no_fleet]").hide()}production_id_first?eco_struc_show_unit_info(production_id_first,true):""});var bld_unit_info_width=0;function eco_struc_show_unit_info(a,h){if(!h){$("#unit"+a).addClass("unit_border_selected")}if(unit_selected){return}$("#unit_id").val(a);$("#unit_amountslide").slider({value:0});$("#unit_amountslide").slider({max:0});var f=production[a];var k="";var e="";var b=$("#unit_info_image");b.attr("src",f.image);$("#unit_info_wiki").attr("unit_id",a);$("#unit_info_description").html(f.description);$("#unit_time").html(f.time);$("#unit_time_div").css("display",f.time_seconds?"block":"none");$("#unit_info_name").html(f.name);if(f.level>0||STACKABLE){$("#unit_info_level").html((!STACKABLE?language.level+" ":"")+f.level+(parseInt(f.level_bonus)>0?'<span class="bonus">+'+f.level_bonus+"</span>":""))}else{$("#unit_info_level").html("&nbsp;")}if(STACKABLE){$("#unit_max").show();$("#unit_max_number").html(sn_format_number(f.can_build));$("#unit_max_number_autoconvert").html(sn_format_number(f.autoconvert_amount))}$("#unit_create, #unit_create *").prop("disabled",true);$("#unit_create_button").button("disable");$("#unit_destroy").css("visibility","hidden");var c;if(require[a]){requirement_string="";for(i in require[a]){c=require[a][i];requirement_string=requirement_string+'<li class="'+(c.requerements_met?"positive":"negative  ")+'">'+c.name+(!isNaN(c.level_basic)?" "+c.level_basic+(c.level_bonus?'<span class="bonus">+'+c.level_bonus+"</span>":"")+"/"+c.level_require:"")+"</li>"}$("#unit_require").empty().append(requirement_string);$("#unit_require_wrapper").show()}else{$("#unit_require_wrapper").hide()}if(grants[a]){requirement_string="";for(i in grants[a]){c=grants[a][i];requirement_string=requirement_string+'<li class="'+(c.requerements_met?"positive":"negative  ")+'">'+c.name+(!isNaN(c.level_basic)?" "+c.level_basic+(c.level_bonus?'<span class="bonus">+'+c.level_bonus+"</span>":"")+"/"+c.level_require:"")+"</li>"}$("#unit_grants").empty().append(requirement_string);$("#unit_grants_wrapper").show()}else{$("#unit_grants_wrapper").hide()}if(TEMPORARY){$("#unit_cost_table").hide()}else{$("#unit_cost_table").css("display","table");eco_struc_make_resource_row("metal",f.metal,f.destroy_metal,f.dark_matter,STACKABLE);eco_struc_make_resource_row("crystal",f.crystal,f.destroy_crystal,f.dark_matter,STACKABLE);eco_struc_make_resource_row("deuterium",f.deuterium,f.destroy_deuterium,f.dark_matter,STACKABLE);eco_struc_make_resource_row("dark_matter",f.dark_matter,f.destroy_dark_matter,f.dark_matter,STACKABLE);if(planet.que_has_place!=0&&!f.unit_busy){if(STACKABLE){$("#auto_convert").change();if(f.build_can!=0&&f.build_result==0){$("#unit_create, #unit_create *").prop("disabled",false);$("#unit_amountslide").slider({max:f.can_build})}}else{if(f.level>0&&f.destroy_can!=0&&f.destroy_result==0){$("#unit_destroy").css("visibility","visible");$("#unit_destroy_level").html(f.level);$("#unit_destroy_resources").html((f.destroy_metal?language.sys_metal[0]+": "+sn_format_number(parseFloat(f.destroy_metal),0,"positive")+" ":"")+(f.destroy_crystal?language.sys_crystal[0]+": "+sn_format_number(parseFloat(f.destroy_crystal),0,"positive")+" ":"")+(f.destroy_deuterium?language.sys_deuterium[0]+":"+sn_format_number(parseFloat(f.destroy_deuterium),0,"positive")+" ":""));$("#unit_destroy_time").html(f.destroy_time)}if(planet.fields_free>0&&f.build_can!=0&&f.build_result==0){$("#unit_create_button").button("enable");$("#unit_create, #unit_create *").prop("disabled",false)}}}}$("#unit_create_button_auto").button(f.can_autoconvert?"enable":"disable").prop("disabled",f.can_autoconvert?false:true);$("#unit_create_level, #unit_create_level_auto").html((parseInt(f.level)?parseInt(f.level):0)+1);k="";if(f.resource_map){var d="";if(STACKABLE){for(i in f.resource_map[0]){if(f.resource_map[0][i]){k+="<tr>";k+='<th class="c_l">'+language[i]+"</th>";k+='<td class="c_r">'+f.resource_map[0][i]+"</td>";k+="</tr>"}}}else{var g=false;for(i in f.resource_map){k+='<tr class="c_r">';for(j in f.resource_map[i]){if(f.resource_map[i][j]){if(!g){switch(j){case"level":d+='<th class="c_l">'+language.level_short+"</th>";break;case"sys_metal":case"sys_crystal":case"sys_deuterium":case"sys_energy":case"sys_expeditions":case"sys_colonies":d+='<th class="c_c" colspan="2">'+language[j];break;case"metal_diff":case"crystal_diff":case"deuterium_diff":case"energy_diff":case"sys_expeditions_diff":case"sys_colonies_diff":d+="</th>";break}}k+="<td>"+sn_format_number(parseFloat(f.resource_map[i][j]),0,"positive",j=="level"?-f.level-f.level_bonus:(j.indexOf("diff")==-1?(f.resource_map[i-1]?-f.resource_map[i-1][j]:0):0),f.resource_map[i][j]>0&&j.indexOf("diff")>=0)+"</td>"}}k+="</tr>";g=true}}k?k=(d?"<tr>"+d+"</tr>":"")+k:false}!k?k='<tr><th class="c_c">'+language.eco_bld_unit_info_extra_none+"</th></tr>":false;$("#unit_balance").html('<table class="border_image_small">'+k+"</table>");$("<style></style>").appendTo($(document.body)).remove()}function eco_struc_select_unit(a){$("#unit_id").val(a);if(unit_selected==a){unit_selected=null}else{if(unit_selected){$("#unit"+unit_selected).removeClass("unit_border_selected");unit_selected=null;eco_struc_show_unit_info(a)}unit_selected=a;$("#unit_amountslide").slider({value:0})}}$(document).on("click","#eco_que_clear",function(a){snConfirm({that:$(this),message:language.eco_que_clear_dialog_text,title:language.eco_que_clear_dialog_title});return false});$(document).on("click","#eco_que_artifact",function(a){snConfirm({that:$(this),message:language.eco_que_artifact_dialog_text.format($(this).text()),title:language.eco_que_artifact_dialog_title.format($(this).text())});return false});